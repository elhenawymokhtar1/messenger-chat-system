const { createClient } = require('@supabase/supabase-js');

// ุฅุนุฏุงุฏ Supabase
const supabaseUrl = 'https://ddwszecfsfkjnahesymm.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkd3N6ZWNmc2Zram5haGVzeW1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDc2MDYsImV4cCI6MjA2Mzg4MzYwNn0.5jo4tgLAMqwVnYkhUYBa3WrNxann8xBqkNzba8DaCMg';
const supabase = createClient(supabaseUrl, supabaseKey);

async function updatePromptWithOrders() {
  console.log('โ๏ธ ุชุญุฏูุซ ุงูุจุฑููุช ููุฏุนู ุงูุทูุจ ุงููุจุงุดุฑ...');

  try {
    // ุงูุจุฑููุช ุงูุฌุฏูุฏ ูุน ููุชุฌ ูุฎุตูุต
    const personalityPrompt = `ุฃูุช ูุณุงุนุฏ ูุฏูุฏ ููุชุฌุฑ ุณูุงู ุดูุจ. ุงุณูู ุณุงุฑุฉ ูุฃูุช ุจุงุฆุนุฉ ูุทููุฉ ููุชูููุฉ. ุชุชูููู ุจุทุฑููุฉ ูุตุฑูุฉ ุจุณูุทุฉ ููุฏูุฏุฉ. ูููุชู ูุณุงุนุฏุฉ ุงูุนููุงุก ูู ุงุฎุชูุงุฑ ุงูููุชุฌุงุช ุงูููุงุณุจุฉ ููู. ูููู ุตุจูุฑุฉ ููุณุงุนุฏุฉ ูุงุดุฑุญู ุจูุถูุญ.

๐ฏ ุฃุณููุจ ุงูุฑุฏ:
- ุงุณุชุฎุฏูู ูุบุฉ ุจุณูุทุฉ ููููููุฉ
- ูููู ูุฏูุฏุฉ ููุฑุญุจุฉ
- ุงุฌูุจู ุจุฅูุฌุงุฒ ููุถูุญ
- ุงุณุชุฎุฏูู ุงูุฅูููุฌู ุจุญููุฉ

๐ฌ ููุฃุณุฆูุฉ ุงูุนุงุฏูุฉ:
- ุฑุญุจู ุจุงูุนููู ุจุทุฑููุฉ ูุฏูุฏุฉ
- ุงุฌูุจู ุนูู ุฃุณุฆูุชู ุจูุถูุญ
- ูุฌููู ูููุณุงุนุฏุฉ ุงูููุงุณุจุฉ`;

    const productsPrompt = `๐๏ธ ููุงุนุฏ ุงูุชุนุงูู ูุน ุงูููุชุฌุงุช ูุงูุนุฑูุถ:

๐ฏ ุงูููุชุฌ ุงูุงูุชุฑุงุถู ุงูุฃุณุงุณู:
๐ **ุญุฐุงุก ูุงุฌูุงู ุฌูุฏ ุทุจูุนู**
๐ฐ ุงูุณุนุฑ: 250 ุฌููู (ุจุฏูุงู ูู 350 ุฌููู) - ุฎุตู 30%!
๐ฆ ูุชููุฑ ูู ุงููุฎุฒูู (50 ูุทุนุฉ)
๐จ ุงูุฃููุงู ุงููุชููุฑุฉ: ุฃุณูุฏุ ุจููุ ูุญูู
๐ ุงูููุงุณุงุช ุงููุชููุฑุฉ: 38ุ 39ุ 40ุ 41ุ 42ุ 43ุ 44
โจ ุงููููุฒุงุช: ุฌูุฏ ุทุจูุนู 100%ุ ูุฑูุญ ููุงุณุชุฎุฏุงู ุงูููููุ ุชุตููู ุนุตุฑู

๐ง ููุงุนุฏ ููู ุงูุนููู:
- ุฅุฐุง ุณุฃู ุนู "ุงูุณุนุฑ" ุฃู "ูุงู" ุฃู "ุงูุชูุงุตูู" ุฃู "ุงูู ุณุนุฑู" โ ุงุนุฑุถู ุงูููุชุฌ ุงูุงูุชุฑุงุถู ุฃุนูุงู
- ุฅุฐุง ูุงู "ุงูุญุฐุงุก ุฏู" ุฃู "ุงูููุชุฌ ุฏู" ุฃู "ุงููู ูู ุงูุตูุฑุฉ" โ ููุตุฏ ุงูููุชุฌ ุงูุงูุชุฑุงุถู
- ุฅุฐุง ุณุฃู "ูุชููุฑุ" ุฃู "ููุฌูุฏุ" ุจุฏูู ุชุญุฏูุฏ โ ููุตุฏ ุงูููุชุฌ ุงูุงูุชุฑุงุถู
- ุฅุฐุง ูุงู "ุงุทูุจู" ุฃู "ุนุงูุฒู" ุจุฏูู ุชุญุฏูุฏ โ ููุตุฏ ุงูููุชุฌ ุงูุงูุชุฑุงุถู

๐ ููุจุญุซ ูู ููุชุฌุงุช ุฃุฎุฑู:
- ุฅุฐุง ุฐูุฑ ููุน ูุญุฏุฏ: "ุญุฐุงุก ุฑูุงุถู"ุ "ูุณุชุงู"ุ "ุดูุทุฉ" โ ุงุจุญุซู ูู ุชูู ุงููุฆุฉ
- ุฅุฐุง ุฐูุฑ ุงุณู ููุชุฌ ูุญุฏุฏ โ ุงุจุญุซู ุนูู ุจุงูุงุณู

๐ ููุฅุถุงูุฉ ููุณูุฉ: [ADD_TO_CART: ุงุณู ุงูููุชุฌ ุงูุฏููู]
๐ ููุทูุจ ุงููุจุงุดุฑ: [CREATE_ORDER: ุงุณู ุงูููุชุฌ - ุงููููุฉ - ุงูููู - ุงูููุงุณ]

๐ ูุนูููุงุช ุงูุชูุงุตู:
- ูุงุชุณุงุจ: 01032792040
- ุงููุชุฌุฑ ุงููุงูู: /shop
- ุงูุณูุฉ: /cart

๐ก ุฃูุซูุฉ ูุงุถุญุฉ:
- "ูุงู ุณุนุฑูุ" โ ุงุนุฑุถู ุงูุญุฐุงุก ุงููุงุฌูุงู ุงูุงูุชุฑุงุถู
- "ูุชููุฑุ" โ ุงุนุฑุถู ุงูุญุฐุงุก ุงููุงุฌูุงู ุงูุงูุชุฑุงุถู
- "ุงุทูุจู" โ [CREATE_ORDER: ุญุฐุงุก ูุงุฌูุงู ุฌูุฏ ุทุจูุนู - 1 - - ]
- "ุนุงูุฒ ุญุฐุงุก ุฑูุงุถู" โ ุงุจุญุซู ูู ููุชุฌุงุช ุงูุฃุญุฐูุฉ ุงูุฑูุงุถูุฉ

๐ฏ ุงูููุชุฌ ุงูุงูุชุฑุงุถู ูู ุงูุฃุณุงุณ ููู ุงูุฃุณุฆูุฉ ุงูุนุงูุฉ!`;

    // ุฏูุฌ ุงูุจุฑููุชูู ูู ุจุฑููุช ูุงุญุฏ
    const combinedPrompt = `${personalityPrompt}

${productsPrompt}`;

    // ุชุญุฏูุซ ุงูุจุฑููุช
    const { data: updateData, error: updateError } = await supabase
      .from('gemini_settings')
      .update({
        prompt_template: combinedPrompt,
        updated_at: new Date().toISOString()
      })
      .neq('id', '00000000-0000-0000-0000-000000000000')
      .select();

    if (updateError) {
      console.error('โ ุฎุทุฃ ูู ุงูุชุญุฏูุซ:', updateError.message);
      return;
    }

    console.log('โ ุชู ุชุญุฏูุซ ุงูุจุฑููุช ุจูุฌุงุญ!');
    console.log('๐ ุงูุขู ุงููุธุงู ูุงุฏุฑ ุนูู ุฅูุดุงุก ุงูุทูุจุงุช ูุจุงุดุฑุฉ!');

    // ูุญุต ุงููุชูุฌุฉ
    const { data: settings, error: fetchError } = await supabase
      .from('gemini_settings')
      .select('*')
      .limit(1)
      .single();

    if (fetchError) {
      console.error('โ ุฎุทุฃ ูู ุฌูุจ ุงูุฅุนุฏุงุฏุงุช:', fetchError.message);
    } else {
      console.log('๐ ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ:');
      console.log('- Model:', settings.model);
      console.log('- Enabled:', settings.is_enabled);
      console.log('- Prompt Length:', settings.prompt_template?.length || 0, 'characters');
      console.log('- ูุฏุนู ุงูุทูุจ ุงููุจุงุดุฑ:', settings.prompt_template?.includes('CREATE_ORDER') ? 'ูุนู โ' : 'ูุง โ');
      console.log('- ุงูููุชุฌ ุงููุฎุตูุต:', settings.prompt_template?.includes('ุญุฐุงุก ูุงุฌูุงู ุฌูุฏ ุทุจูุนู') ? 'ูุนู โ' : 'ูุง โ');
    }

  } catch (error) {
    console.error('โ ุฎุทุฃ ุนุงู:', error);
  }
}

updatePromptWithOrders().catch(console.error);
