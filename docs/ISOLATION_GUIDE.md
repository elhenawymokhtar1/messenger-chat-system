# ๐ ุฏููู ุงูุนุฒู ูููุทูุฑูู
## Developer's Isolation Guide

> **ูุงู ุฌุฏุงู**: ูุฌุจ ูุฑุงุกุฉ ูุฐุง ุงูุฏููู ูุจู ุฅุถุงูุฉ ุฃู ููุฒุฉ ุฌุฏูุฏุฉ ูููุธุงู

## ๐ **ููุงุนุฏ ุงูุนุฒู ุงูุฃุณุงุณูุฉ**

### **1. ูู ุดุฑูุฉ ูุนุฒููุฉ ุชูุงูุงู**
- โ ูู ุดุฑูุฉ ุชุฑู ุจูุงูุงุชูุง ููุท
- โ ูุง ูุฌุจ ุฃู ุชุฑู ุดุฑูุฉ ุจูุงูุงุช ุดุฑูุฉ ุฃุฎุฑู
- ๐ ุงุณุชุฎุฏู `company_id` ุฃู `store_id` ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช

### **2. ุงูุฌุฏุงูู ุงูุชู ุชุญุชุงุฌ ุนุฒู**
```typescript
const TABLES_REQUIRING_ISOLATION = [
  'products',      // ุงูููุชุฌุงุช
  'categories',    // ุงููุฆุงุช  
  'orders',        // ุงูุทูุจุงุช
  'coupons',       // ุงูููุจููุงุช
  'shipping_methods', // ุทุฑู ุงูุดุญู
  'payment_methods',  // ุทุฑู ุงูุฏูุน
  'stores',        // ุงููุชุงุฌุฑ
  'customers'      // ุงูุนููุงุก
];
```

### **3. ุฃุนูุฏุฉ ุงูุนุฒู ุงูููุจููุฉ**
- `company_id` - ุงูุฃูุถู
- `store_id` - ุจุฏูู ููุจูู

## ๐ซ **ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ**

### **โ ุฎุทุฃ: ุงุณุชุนูุงู ุจุฏูู ุนุฒู**
```sql
-- ุฎุทุฃ - ูุฌูุจ ุจูุงูุงุช ุฌููุน ุงูุดุฑูุงุช
SELECT * FROM products WHERE status = 'active';
```

### **โ ุตุญูุญ: ุงุณุชุนูุงู ูุนุฒูู**
```sql
-- ุตุญูุญ - ูุฌูุจ ุจูุงูุงุช ุดุฑูุฉ ูุงุญุฏุฉ ููุท
SELECT * FROM products WHERE company_id = ? AND status = 'active';
```

### **โ ุฎุทุฃ: ุฅุฏุฑุงุฌ ุจุฏูู ุนุฒู**
```sql
-- ุฎุทุฃ - ูุง ูุญุฏุฏ ุงูุดุฑูุฉ
INSERT INTO categories (name, description) VALUES (?, ?);
```

### **โ ุตุญูุญ: ุฅุฏุฑุงุฌ ูุนุฒูู**
```sql
-- ุตุญูุญ - ูุญุฏุฏ ุงูุดุฑูุฉ
INSERT INTO categories (company_id, name, description) VALUES (?, ?, ?);
```

## ๐๏ธ **ุฃุฏูุงุช ุงูุนุฒู**

### **1. ุงุณุชุฎุฏุงู IsolatedQueryBuilder**
```typescript
import { IsolatedQueryBuilder } from '../utils/isolation-guard';

// ุฅูุดุงุก ููุดุฆ ุงูุงุณุชุนูุงูุงุช
const builder = new IsolatedQueryBuilder(companyId, storeId);

// ุฌูุจ ุงูุจูุงูุงุช
const { query, values } = builder.buildSelectQuery(
  'products',           // ุงุณู ุงูุฌุฏูู
  '*',                 // ุงูุฃุนูุฏุฉ
  'status = ?',        // ุดุฑูุท ุฅุถุงููุฉ
  'created_at DESC',   // ุชุฑุชูุจ
  20,                  // ุญุฏ
  0                    // ุฅุฒุงุญุฉ
);

const [results] = await pool.execute(query, [...values, 'active']);
```

### **2. ุงุณุชุฎุฏุงู Middleware ููุญูุงูุฉ**
```typescript
import { isolationGuardMiddleware } from '../utils/isolation-guard';

// ุชุทุจูู ุงูุญูุงูุฉ ุนูู ุฌููุน ูุณุงุฑุงุช ุงูุดุฑูุฉ
app.use('/api/companies/:companyId/*', isolationGuardMiddleware);
```

### **3. ุงูุชุญูู ูู ุงูุงุณุชุนูุงูุงุช**
```typescript
import { validateIsolationInQuery } from '../utils/isolation-guard';

const query = 'SELECT * FROM products WHERE status = ?';
const validation = validateIsolationInQuery(query, companyId);

if (!validation.isValid) {
  console.warn('โ๏ธ ุชุญุฐูุฑุงุช:', validation.warnings);
  console.log('๐ก ุงูุชุฑุงุญุงุช:', validation.suggestions);
}
```

## ๐ **ูุงุฆูุฉ ูุฑุงุฌุนุฉ ูููุทูุฑ**

### **ุนูุฏ ุฅุถุงูุฉ ูุณุงุฑ API ุฌุฏูุฏ:**
- [ ] ูู ูุญุชูู ุงููุณุงุฑ ุนูู `companyId`ุ
- [ ] ูู ุชู ุชุทุจูู `isolationGuardMiddleware`ุ
- [ ] ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชุญุชูู ุนูู ุดุฑุท ุงูุนุฒูุ
- [ ] ูู ุชู ุงุฎุชุจุงุฑ ุงูุนุฒู ูุน ุดุฑูุชูู ูุฎุชููุชููุ

### **ุนูุฏ ุฅุถุงูุฉ ุฌุฏูู ุฌุฏูุฏ:**
- [ ] ูู ูุญุชุงุฌ ุงูุฌุฏูู ููุนุฒูุ
- [ ] ูู ุชู ุฅุถุงูุฉ ุนููุฏ `company_id` ุฃู `store_id`ุ
- [ ] ูู ุชู ุฅุถุงูุฉ ุงูุฌุฏูู ููุงุฆูุฉ `TABLES_REQUIRING_ISOLATION`ุ
- [ ] ูู ุชู ุฅูุดุงุก ุงุฎุชุจุงุฑุงุช ุงูุนุฒู ููุฌุฏูู ุงูุฌุฏูุฏุ

### **ุนูุฏ ุชุนุฏูู ุงุณุชุนูุงู ููุฌูุฏ:**
- [ ] ูู ูุง ูุฒุงู ุงูุงุณุชุนูุงู ูุนุฒููุงูุ
- [ ] ูู ุชู ุงุฎุชุจุงุฑ ุงูุชุนุฏูู ูุน ุดุฑูุงุช ูุชุนุฏุฏุฉุ
- [ ] ูู ุชู ุชุญุฏูุซ ุงูุงุฎุชุจุงุฑุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑุ

## ๐งช **ุงุฎุชุจุงุฑ ุงูุนุฒู**

### **ุงุฎุชุจุงุฑ ูุฏูู ุณุฑูุน:**
```bash
# ุฌูุจ ุจูุงูุงุช ุงูุดุฑูุฉ A
curl "http://localhost:3002/api/companies/COMPANY_A_ID/categories"

# ุฌูุจ ุจูุงูุงุช ุงูุดุฑูุฉ B  
curl "http://localhost:3002/api/companies/COMPANY_B_ID/categories"

# ูุฌุจ ุฃู ุชููู ุงููุชุงุฆุฌ ูุฎุชููุฉ!
```

### **ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุงูุชููุงุฆูุฉ:**
```bash
npm test -- isolation.test.ts
```

## ๐จ **ุนูุงูุงุช ุงูุฎุทุฑ**

### **ููุฏ ูุญุชุงุฌ ูุฑุงุฌุนุฉ ููุฑูุฉ:**
- ุงุณุชุนูุงูุงุช ุจุฏูู `WHERE`
- ุงุณุชุฎุฏุงู `SELECT *` ุจุฏูู ุนุฒู
- ุงุณุชุนูุงูุงุช `JOIN` ุจุฏูู ุดุฑูุท ุนุฒู
- ุงุณุชุฎุฏุงู `localStorage` ูู ููุฏ ุฌุฏูุฏ
- ูุณุงุฑุงุช API ุจุฏูู `companyId`

### **ุฑุณุงุฆู ุชุญุฐูุฑูุฉ ูู ุงูุฎุงุฏู:**
```
โ๏ธ [API] ุฌุฏูู categories ูุง ูุญุชูู ุนูู company_id
โ๏ธ [ISOLATION-GUARD] ุทูุจ API ุจุฏูู companyId
โ๏ธ ุงุณุชุนูุงู ุจุฏูู ุนุฒู ูุณุชุฎุฏู ุงูุฌุฏุงูู: products
```

## ๐ง **ุฅุตูุงุญ ุงููุดุงูู**

### **ุฅุฐุง ุธูุฑุช ุจูุงูุงุช ุดุฑูุฉ ูู ุดุฑูุฉ ุฃุฎุฑู:**
1. ุชุญูู ูู ูุฌูุฏ ุดุฑุท ุงูุนุฒู ูู ุงูุงุณุชุนูุงู
2. ุชุฃูุฏ ูู ุตุญุฉ ูููุฉ `companyId`
3. ูุญุต ุงูุฌุฏูู ููุชุฃูุฏ ูู ูุฌูุฏ ุนููุฏ ุงูุนุฒู
4. ุฑุงุฌุน ุงูุงุฎุชุจุงุฑุงุช ููุชุฃูุฏ ูู ุชุบุทูุฉ ุงูุญุงูุฉ

### **ุฅุฐุง ูุดู ุฅูุดุงุก ุจูุงูุงุช ุฌุฏูุฏุฉ:**
1. ุชุฃูุฏ ูู ุฅุถุงูุฉ `company_id` ุฃู `store_id`
2. ุชุญูู ูู ูุฌูุฏ ูุชุฌุฑ ููุดุฑูุฉ
3. ุฑุงุฌุน ูููุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุชุฃูุฏ ูู ุตุญุฉ ูุนุฑู ุงูุดุฑูุฉ

## ๐ **ูุฑุงูุจุฉ ุงูุนุฒู**

### **ูุญุต ุฏูุฑู ูุญุงูุฉ ุงูุนุฒู:**
```typescript
import { checkIsolationHealth } from '../utils/isolation-guard';

const health = await checkIsolationHealth(pool);
console.log('ุญุงูุฉ ุงูุนุฒู:', health.status);
if (health.issues.length > 0) {
  console.warn('ูุดุงูู ุงูุนุฒู:', health.issues);
  console.log('ุงูุชูุตูุงุช:', health.recommendations);
}
```

## ๐ฏ **ุฃูุฏุงู ุงูุนุฒู**

### **ุงููุฏู ุงูุฃุณุงุณู:**
> ุถูุงู ุฃู ูู ุดุฑูุฉ ุชุฑู ุจูุงูุงุชูุง ููุทุ ููุง ุชุณุชุทูุน ุงููุตูู ูุจูุงูุงุช ุงูุดุฑูุงุช ุงูุฃุฎุฑู

### **ุงูููุงุฆุฏ:**
- ๐ **ุงูุฃูุงู**: ุญูุงูุฉ ุจูุงูุงุช ุงูุนููุงุก
- โก **ุงูุฃุฏุงุก**: ุงุณุชุนูุงูุงุช ุฃุณุฑุน ูุน ุจูุงูุงุช ุฃูู
- ๐งน **ุงููุธุงูุฉ**: ูุงุฌูุฉ ูุณุชุฎุฏู ุฃูุซุฑ ูุถูุญุงู
- ๐ **ุงูุฏูุฉ**: ุฅุญุตุงุฆูุงุช ุตุญูุญุฉ ููู ุดุฑูุฉ

---

## โ๏ธ **ุชุฐููุฑ ููู**

**ูุจู ูุดุฑ ุฃู ููุฏ ุฌุฏูุฏุ ุชุฃูุฏ ูู:**
1. โ ุชุทุจูู ุงูุนุฒู ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช
2. โ ุงุฎุชุจุงุฑ ุงูุนุฒู ูุน ุดุฑูุงุช ูุชุนุฏุฏุฉ  
3. โ ุนุฏู ุงุณุชุฎุฏุงู localStorage
4. โ ุชูุญูุฏ ูุนุฑูุงุช ุงูุดุฑูุฉ

**ุงูุนุฒู ููุณ ุงุฎุชูุงุฑูุงู - ุฅูู ุถุฑูุฑุฉ ุฃูููุฉ!** ๐
