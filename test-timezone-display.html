<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚ÙŠØª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .time-display {
            font-size: 18px;
            font-weight: bold;
            color: #2563eb;
            margin: 10px 0;
        }
        .settings-info {
            background: #e0f2fe;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ• Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚ÙŠØª</h1>
        
        <div class="test-section">
            <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div class="settings-info">
                <div id="current-settings">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            <button onclick="updateTimezone('Africa/Cairo')">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</button>
            <button onclick="updateTimezone('Asia/Riyadh')">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶</button>
            <button onclick="updateTimezone('Europe/London')">ØªØ¹ÙŠÙŠÙ† Ù„Ù†Ø¯Ù†</button>
        </div>

        <div class="test-section">
            <h3>ğŸ• Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
            <div class="time-display" id="current-time">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“¨ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø³ÙŠÙ‚ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h3>
            <div id="message-times">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø¨ÙŠ</h3>
            <div id="relative-times">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
    </div>

    <script>
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function getUserTimezone() {
            const savedSettings = localStorage.getItem('systemSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                return settings.timezone || 'Africa/Cairo';
            }
            return 'Africa/Cairo';
        }

        function convertToLocalTime(timeString, timezone) {
            if (!timeString) return new Date();
            
            try {
                const date = new Date(timeString);
                if (isNaN(date.getTime())) {
                    return new Date();
                }
                return date;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª:', error);
                return new Date();
            }
        }

        function formatTime(timeString, timezone) {
            const userTimezone = timezone || getUserTimezone();
            if (!timeString) return '';
            
            try {
                const date = convertToLocalTime(timeString, userTimezone);
                return date.toLocaleTimeString('ar-EG', {
                    timeZone: userTimezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª:', error);
                return timeString;
            }
        }

        function formatRelativeTime(timeString, timezone) {
            const userTimezone = timezone || getUserTimezone();
            if (!timeString) return '';
            
            try {
                const date = convertToLocalTime(timeString, userTimezone);
                const now = new Date();
                const diffMs = now.getTime() - date.getTime();
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return "Ø§Ù„Ø¢Ù†";
                if (diffMins < 60) return `Ù…Ù†Ø° ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
                if (diffHours < 24) return `Ù…Ù†Ø° ${diffHours} Ø³Ø§Ø¹Ø©`;
                if (diffDays < 7) return `Ù…Ù†Ø° ${diffDays} ÙŠÙˆÙ…`;

                return date.toLocaleDateString('ar-EG', { timeZone: userTimezone });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø¨ÙŠ:', error);
                return timeString;
            }
        }

        function updateTimezone(timezone) {
            const settings = {
                timezone: timezone,
                language: 'ar',
                theme: 'light'
            };
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            updateDisplay();
            alert(`ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¥Ù„Ù‰: ${timezone}`);
        }

        function updateDisplay() {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const currentTimezone = getUserTimezone();
            document.getElementById('current-settings').innerHTML = `
                <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</strong> ${currentTimezone}<br>
                <strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ø¬Ù‡Ø§Ø²:</strong> ${new Date().toLocaleString('ar-EG')}<br>
                <strong>Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</strong> ${new Date().toLocaleString('ar-EG', { timeZone: currentTimezone })}
            `;

            // Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            document.getElementById('current-time').textContent = 
                new Date().toLocaleString('ar-EG', { timeZone: currentTimezone });

            // Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            const testTimes = [
                new Date().toISOString(), // Ø§Ù„Ø¢Ù†
                new Date(Date.now() - 5 * 60 * 1000).toISOString(), // Ù…Ù†Ø° 5 Ø¯Ù‚Ø§Ø¦Ù‚
                new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†
                new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // Ø£Ù…Ø³
            ];

            let messageTimesHtml = '';
            testTimes.forEach((time, index) => {
                messageTimesHtml += `
                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                        <strong>Ø±Ø³Ø§Ù„Ø© ${index + 1}:</strong><br>
                        <strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£ØµÙ„ÙŠ:</strong> ${time}<br>
                        <strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø³Ù‚:</strong> ${formatTime(time)}<br>
                        <strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø¨ÙŠ:</strong> ${formatRelativeTime(time)}
                    </div>
                `;
            });
            document.getElementById('message-times').innerHTML = messageTimesHtml;

            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø¨ÙŠ
            const relativeTimes = [
                { label: 'Ø§Ù„Ø¢Ù†', time: new Date().toISOString() },
                { label: 'Ù…Ù†Ø° Ø¯Ù‚ÙŠÙ‚Ø©', time: new Date(Date.now() - 60 * 1000).toISOString() },
                { label: 'Ù…Ù†Ø° 30 Ø¯Ù‚ÙŠÙ‚Ø©', time: new Date(Date.now() - 30 * 60 * 1000).toISOString() },
                { label: 'Ù…Ù†Ø° 3 Ø³Ø§Ø¹Ø§Øª', time: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString() },
                { label: 'Ù…Ù†Ø° ÙŠÙˆÙ…ÙŠÙ†', time: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString() },
            ];

            let relativeTimesHtml = '';
            relativeTimes.forEach(item => {
                relativeTimesHtml += `
                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                        <strong>${item.label}:</strong> ${formatRelativeTime(item.time)}
                    </div>
                `;
            });
            document.getElementById('relative-times').innerHTML = relativeTimesHtml;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        setInterval(updateDisplay, 1000);
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ
        updateDisplay();
    </script>
</body>
</html>
