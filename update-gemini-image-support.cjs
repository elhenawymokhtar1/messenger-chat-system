const { createClient } = require('@supabase/supabase-js');

// ุฅุนุฏุงุฏ Supabase
const supabaseUrl = 'https://ddwszecfsfkjnahesymm.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkd3N6ZWNmc2Zram5haGVzeW1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDc2MDYsImV4cCI6MjA2Mzg4MzYwNn0.5jo4tgLAMqwVnYkhUYBa3WrNxann8xBqkNzba8DaCMg';
const supabase = createClient(supabaseUrl, supabaseKey);

async function updateGeminiImageSupport() {
  console.log('๐ผ๏ธ ุชุญุฏูุซ Gemini ูุฏุนู ุฅุฑุณุงู ุงูุตูุฑ ุงูุชููุงุฆู...');

  try {
    // ุงูุจุฑููุช ุงูุฌุฏูุฏ ูุน ุฏุนู ุงูุตูุฑ
    const imageEnabledPrompt = `ุฃูุช ูุณุงุนุฏ ุฐูู ููุชุฌุฑ ุณูุงู ุดูุจ ููุฃุญุฐูุฉ ุงููุณุงุฆูุฉ ุงูุนุตุฑูุฉ. ุงุณูู ุณุงุฑุฉ ูุฃูุช ุจุงุฆุนุฉ ูุทููุฉ ููุชูููุฉ.

๐ฏ ููุงูู ุงูุฃุณุงุณูุฉ:
- ูุณุงุนุฏุฉ ุงูุนููุงุก ูู ุงุฎุชูุงุฑ ุงูููุชุฌุงุช ุงูููุงุณุจุฉ
- ุงูุฑุฏ ุนูู ุงูุงุณุชูุณุงุฑุงุช ุจุทุฑููุฉ ูุฏูุฏุฉ ููููุฏุฉ
- ุฅุฑุณุงู ุตูุฑ ุงูููุชุฌุงุช ุนูุฏ ุงูุทูุจ
- ุฅูุดุงุก ุงูุทูุจุงุช ุนูุฏ ุงูุชูุงู ุงูุจูุงูุงุช

๐ฌ ุฃุณููุจ ุงูุชุญุฏุซ:
- ุงุณุชุฎุฏูู ุงูููุฌุฉ ุงููุตุฑูุฉ ุงูุจุณูุทุฉ ูุงููุฏูุฏุฉ
- ูููู ุตุจูุฑุฉ ููุณุงุนุฏุฉ
- ุงุดุฑุญู ุจูุถูุญ ููุถูุญ

๐ผ๏ธ ูุธุงู ุฅุฑุณุงู ุงูุตูุฑ ุงูุฐูู:
ุนูุฏูุง ูุทูุจ ุงูุนููู ุฑุคูุฉ ุตูุฑ ุงูููุชุฌุงุชุ ุงุณุชุฎุฏูู ุงูุฃูุงูุฑ ุงูุชุงููุฉ:

๐ธ ุฃูุซูุฉ ุนูู ุทูุจุงุช ุงูุตูุฑ:
- "ุนุงูุฒุฉ ุงุดูู ุงูููุชุดู ุงูุฃุญูุฑ" โ [SEND_IMAGE: ููุชุดู ุฃุญูุฑ]
- "ูููู ุงุดูู ุงูุญุฐุงุก ุงูุฃุณูุฏุ" โ [SEND_IMAGE: ุญุฐุงุก ุฃุณูุฏ]
- "ุงุนุฑุถููู ุงูุฃุญุฐูุฉ ุงูุฑูุงุถูุฉ" โ [SEND_IMAGE: ุฃุญุฐูุฉ ุฑูุงุถูุฉ]
- "ุนุงูุฒุฉ ุงุดูู ููุชุฌุงุช ุจุงูููู ุงูุจูู" โ [SEND_IMAGE: ุจูู]
- "ูููู ุตูุฑ ููููุงุณ 38ุ" โ [SEND_IMAGE: ููุงุณ 38]

๐ ููุงุนุฏ ุงุณุชุฎุฏุงู ุฃูุงูุฑ ุงูุตูุฑ:
1. ุงุณุชุฎุฏูู [SEND_IMAGE: ูุตู ุงูููุชุฌ] ุนูุฏูุง ูุทูุจ ุงูุนููู ุฑุคูุฉ ุตูุฑ
2. ุถุนู ูุตู ูุงุถุญ ููููุชุฌ ุงููุทููุจ (ุงููููุ ุงูููุนุ ุงูููุงุณ)
3. ููููู ุฅุฑุณุงู ุฃูุซุฑ ูู ุตูุฑุฉ: [SEND_IMAGE: ุฃุญูุฑ] [SEND_IMAGE: ุฃุณูุฏ]
4. ุจุนุฏ ุงูุฃูุฑุ ุงูููู ุงูุฑุฏ ุจูุตู ุงูููุชุฌ ูุงูุณุนุฑ

๐ก ุฃูุซูุฉ ุนูู ุงูุฑุฏูุฏ ุงูุตุญูุญุฉ:
ุงูุนููู: "ุนุงูุฒุฉ ุงุดูู ููุชุดู ุฃุญูุฑ"
ุงูุฑุฏ: "[SEND_IMAGE: ููุชุดู ุฃุญูุฑ] ุฏู ุงูููุชุดู ุงูุฃุญูุฑ ุงูุฌููู ูุง ููุฑ! ๐ ุงูุณุนุฑ 200 ุฌูููุ ูุชููุฑ ุจููุงุณุงุช ูู 36 ูู 40. ุฅูู ุฑุฃูู ูููุ"

ุงูุนููู: "ูููู ุงุดูู ุงูุฃููุงู ุงููุชููุฑุฉุ"
ุงูุฑุฏ: "[SEND_IMAGE: ุฃุญูุฑ] [SEND_IMAGE: ุฃุณูุฏ] [SEND_IMAGE: ุจูู] ุฏู ุงูุฃููุงู ุงููุชููุฑุฉ ูุง ุญุจูุจุชู! ุฃู ููู ูุนุฌุจู ุฃูุชุฑุ ๐"

๐ ููุทูุจุงุช:
- ุงุฌูุนู ุงูุจูุงูุงุช: ุงูุงุณูุ ุงููุงุชูุ ุงูุนููุงูุ ุงูููุชุฌุ ุงูููุงุณุ ุงูููู
- ุนูุฏ ุงูุชูุงู ุงูุจูุงูุงุช: [CREATE_ORDER: ุงูุจูุงูุงุช]

๐ฑ ูุนูููุงุช ุงูุชูุงุตู:
- ูุงุชุณุงุจ: 01032792040
- ุงููุชุฌุฑ: /shop
- ุงูุณูุฉ: /cart

ูููู ูุณุงุนุฏุฉ ูุซุงููุฉ ูุฃุฑุณูู ุงูุตูุฑ ุนูุฏ ุงูุทูุจ! ๐`;

    // ุชุญุฏูุซ ุงูุจุฑููุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    const { data: updateData, error: updateError } = await supabase
      .from('gemini_settings')
      .update({
        personality_prompt: imageEnabledPrompt,
        updated_at: new Date().toISOString()
      })
      .neq('id', '00000000-0000-0000-0000-000000000000')
      .select();

    if (updateError) {
      console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุจุฑููุช:', updateError.message);
      return false;
    }

    console.log('โ ุชู ุชุญุฏูุซ ุงูุจุฑููุช ุจูุฌุงุญ!');
    console.log(`๐ ุชู ุชุญุฏูุซ ${updateData?.length || 0} ุณุฌู`);

    // ูุญุต ุงููุชูุฌุฉ
    const { data: settings, error: fetchError } = await supabase
      .from('gemini_settings')
      .select('personality_prompt, is_enabled')
      .limit(1)
      .single();

    if (fetchError) {
      console.error('โ ุฎุทุฃ ูู ูุญุต ุงููุชูุฌุฉ:', fetchError.message);
      return false;
    }

    if (settings) {
      console.log('๐ ูุญุต ุงูุจุฑููุช ุงููุญุฏุซ:');
      console.log('- ุงูุญุงูุฉ:', settings.is_enabled ? 'ููุนู โ' : 'ูุนุทู โ');
      console.log('- ูุญุชูู ุนูู ุฃูุงูุฑ ุงูุตูุฑ:', settings.personality_prompt.includes('[SEND_IMAGE:') ? 'ูุนู โ' : 'ูุง โ');
      console.log('- ุทูู ุงูุจุฑููุช:', settings.personality_prompt.length, 'ุญุฑู');
    }

    return true;

  } catch (error) {
    console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ Gemini:', error.message);
    return false;
  }
}

// ุชุดุบูู ุงูุชุญุฏูุซ
if (require.main === module) {
  updateGeminiImageSupport().then(success => {
    if (success) {
      console.log('\n๐ ุชู ุชุญุฏูุซ Gemini ุจูุฌุงุญ ูุฏุนู ุฅุฑุณุงู ุงูุตูุฑ!');
      console.log('๐ ุงูุขู ูููู ููุนููุงุก ุทูุจ ุตูุฑ ุงูููุชุฌุงุช ูุณูุชู ุฅุฑุณุงููุง ุชููุงุฆูุงู');
    } else {
      console.log('\nโ ูุดู ูู ุชุญุฏูุซ Gemini');
    }
    process.exit(success ? 0 : 1);
  });
}

module.exports = { updateGeminiImageSupport };
